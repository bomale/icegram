jQuery(function(){function e(e){var t=jQuery(e).find(".message_type option:selected").val(),a=jQuery(e).find(".message_row.ig_"+t).find(".message_theme").val(),i=jQuery(e).find("#message_theme_ig_"+t).find("."+a).attr("style");jQuery(e).find("#embed_form_but").hide(),jQuery(e).find(".message_row, .location").hide(),jQuery(e).find(".ig_"+t).show(),jQuery(e).find(".message_row.ig_"+t).find(".message_theme").next().find(".chosen-single span").attr("style",i),"block"!==jQuery(e).find(".message_body").parent().css("display")?jQuery(e).find(".message_body").parent().next(".wp-editor-wrap").hide():jQuery(e).find(".message_body").parent().next(".wp-editor-wrap").show()}function t(e,a,i){var r=Math.floor(Math.random()*(i-a+1))+a;return r==e?t(r,a,i):r}function a(){var e='<span><label class="options_header"><span id="valid-field"> </span></label> <input  type="text" class="url_input_field" data-option="local_url"  name="campaign_target_rules[local_urls][]" value="'+r+'*"/><span class="delete-url"></span></span>';return e}function i(){0==jQuery(".message-row").length?jQuery(".empty_campaign").show():jQuery(".empty_campaign").hide()}var r=icegram_writepanel_params.home_url;jQuery("#campaign_data").find("h3.hndle").hide(),jQuery(".target_rules_desc").appendTo("#campaign_target_rules h3.hndle span"),jQuery(document).ready(function(){var a=window.send_to_editor;jQuery("#postdivrich").hide(),jQuery(".color-field").wpColorPicker().each(function(e){var t=jQuery(this).data("color-label")||"";""!==t&&jQuery(this).closest(".wp-picker-container").find("a.wp-color-result").attr("title",t)}),jQuery("#campaign_data").on("change",".show_color_options",function(){jQuery(this).closest("p").next(".message_colors_options_container").toggle(!this.checked)}).change(),i(),jQuery(".message_edit:first").trigger("click"),this_data=jQuery(".message_type option:selected").closest(".message-setting-fields");for(var r=0;r<this_data.length;r++)e(this_data[r]);jQuery(".inside").on("change",".message_type",function(t){var a=jQuery(t.target).parents(".message-setting-fields");e(a)}),jQuery("#campaign_data,#message-settings").on("change",".message_theme",function(e){var t=jQuery(e.target).parents(".message-setting-fields"),a=jQuery(t).find(".message_type").val(),i=jQuery(t).find(".message_row.ig_"+a).find(".message_theme").val(),r=jQuery(t).find("#message_theme_ig_"+a).find("."+i).attr("style");jQuery(t).find(".message_row.ig_"+a).find(".message_theme").next().find(".chosen-single span").attr("style",r)}),jQuery("#campaign_data").on("click",".message_image_button",function(e){var t=this;return window.send_to_editor=function(e){imgurl=jQuery("img",e).attr("src"),jQuery(t).parent().find("#upload_image").val(imgurl),tb_remove(),window.send_to_editor=a},!1}),jQuery("#campaign_data ,#message-settings").on("click",".message_headline_button",function(){var e=jQuery(this).prev().attr("data-headline"),a=icegram_writepanel_params.available_headlines.length,i=t(e,0,a),r=icegram_writepanel_params.available_headlines[i];jQuery(this).prev().val(r)}),jQuery(".tips, .help_tip").tipTip({attribute:"data-tip"}),jQuery("span.test_class").hover(function(){jQuery(this).next().show()},function(){jQuery(this).next().hide()}),jQuery("#campaign_data .hndle, #campaign_data .handlediv").unbind("click"),jQuery("#campaign_data .handlediv").hide()}),jQuery("#campaign_data").on("click",".message_delete",function(){jQuery(this).parent().parent().next().remove(),jQuery(this).parent().parent().remove(),i()}),jQuery("#campaign_data").on("click",".message_edit",function(){jQuery(this).parent().parent().next().toggle(),jQuery(this).parent().parent().find(".message-title-text, .message-title-input").toggle()}),jQuery("#campaign_data").on("change",".message-title-input",function(){jQuery(this).prev().text(jQuery(this).val())}),jQuery("select.ajax_chosen_select_messages").ajaxChosen({type:"GET",url:icegram_writepanel_params.ajax_url,dataType:"json",afterTypeDelay:100,data:{action:"icegram_json_search_messages",security:icegram_writepanel_params.search_message_nonce}},function(e){var t={};return jQuery.each(e,function(e,a){t[e]=a}),t}),jQuery(document).on("click","#embed_form_but",function(e){jQuery.magnificPopup.open({items:{src:"#popup_container",type:"inline"},modal:!0})}),jQuery(document).on("click",".cancel_parse_form",function(e){return jQuery.magnificPopup.close({items:{src:"#popup_container",type:"inline"}}),jQuery(this).closest("form").get(0).reset(),!1}),jQuery(document).on("click",".parse_form",function(e){var t=this,a=jQuery(t).closest("form"),i=jQuery(a).find(".embed_form_layouts input[type=radio]:checked").val(),r=jQuery(a).find("#embed_form_width option:selected").val(),n=jQuery(a).find("#embed_form_positions option:selected").val(),s=jQuery('<ul class="ig_embed_form_container"></ul>').addClass("ig_clear"),o=jQuery(a).find(".has_label_check input[type=checkbox]:checked").length>0?!0:!1,l=jQuery(a).find("textarea#form_data").val().trim(),u=jQuery("<div/>").html(l).find("input, label, select, textarea, button").not("br");jQuery(a).find(".use_cta_check input[type=checkbox]:checked").length>0&&(u=u.not("input[type=submit]"),u=u.not("button[type=submit]"));var c=jQuery("<div/>").html(l).find("form").removeAttr("class").addClass("ig_embed_form").addClass(i).addClass(r).addClass(n).addClass("ig_clear").empty(),d=null,p=0;if(jQuery.each(u,function(e,t){var a=jQuery(t),i=jQuery('<li class="ig_form_el_group"></li>');if(a.removeAttr("class").removeAttr("style"),(-1==a.attr("tabindex")||"hidden"==a.attr("type"))&&(a.addClass("ig_detected_bot_fields"),p--),a.is("label"))d=a.not("input, select, textarea, button, span, br").text().replace(/\s+/g," ");else if((a.is("input")||a.is("button")||a.is("textarea"))&&!a.is("input[type=radio]")){if(a.removeAttr("id"),a.is("button")){var r=a.not("br, span, div").text().trim()||"";a.remove(),a=jQuery('<input type="submit">'),r&&a.attr("value",r)}o?(a.removeAttr("placeholder"),d&&(jQuery("<label>"+d+"</label>").appendTo(i),d=null)):d&&(a.attr("placeholder",d),d=null),i.append(a),i.append(a).addClass(a.is("textarea")?"ig_form_el_textarea":"ig_form_el_input"),s.append(i),p++}else a.is("select")?(d&&(o?jQuery("<label>"+d+"</label>").appendTo(i):jQuery("<option>"+d+"</option>").prependTo(a),d=null),i.append(a).addClass("ig_form_el_select"),s.append(i),p++):a.is("input[type=radio]")&&(d&&(jQuery("<label>"+d+"</label>").prepend(a).appendTo(i),d=null),i.addClass("ig_form_el_radio"),s.append(i),p++)}),"ig_horizontal"==i){var _="ig_full"==r?4:"ig_half"==r?2:1;p=p>_?_:p;var g=(100-p)/p;s.find("input, select, textarea").not("input[type=submit]").not("input[type=radio]").not("input[type=hidden]").parent().css("width",g+"%"),s.find("input[type=radio]").parent().parent().css("width",g+"%")}return s.find(".ig_detected_bot_fields").parent().css("display","none"),c.append(s),jQuery.magnificPopup.close({items:{src:"#popup_container",type:"inline"}}),jQuery(t).closest("form").get(0).reset(),window.send_to_editor(jQuery("<div/>").append(c).html()),!1}),jQuery(".ajax_chosen_select_messages").chosen(),jQuery("#campaign_data").on("change",".ajax_chosen_select_messages",function(){var t=jQuery("#ig-tabs li.current").attr("variation_id"),a=jQuery.extend({},tinyMCEPreInit.mceInit.content),r=jQuery.extend({},tinyMCEPreInit.qtInit.content),n=jQuery(this).parent().siblings(".campaign_target_rules_panel"),s=jQuery(n).find(".message-row").length,o=jQuery(this).val();return""==o?void jQuery(".ajax_chosen_select_messages").val("").trigger("chosen:updated"):(jQuery(".message-edit-row").hide(),jQuery(".message-title-text").show(),jQuery(".message-title-input").hide(),void jQuery.ajax({type:"POST",url:icegram_writepanel_params.ajax_url,dataType:"json",data:{action:"get_message_action_row",message_id:o,row:s},success:function(o){if(s++,jQuery(n).find(".messages-list .messages_list_table tbody").append(o.main),jQuery(".color-field").wpColorPicker().each(function(e){var t=jQuery(this).data("color-label")||"";""!==t&&jQuery(this).closest(".wp-picker-container").find("a.wp-color-result").attr("title",t)}),jQuery("#campaign_data").on("change",".show_color_options",function(){jQuery(this).closest("p").next(".message_colors_options_container").toggle(!this.checked)}).change(),e(jQuery("#"+o.id)),jQuery(".ajax_chosen_select_messages").val("").trigger("chosen:updated"),jQuery("select.icegram_chosen_page").chosen({disable_search_threshold:10}),i(),jQuery(".message-setting-fields").trigger("change"),jQuery(".tips, .help_tip").tipTip({attribute:"data-tip"}),"undefined"==typeof tinyMCEPreInit.mceInit["edit"+o.id]){for(_prop in a)"string"==typeof a[_prop]&&"content_css"!==_prop&&(a[_prop]=a[_prop].replace(new RegExp("content","g"),"edit"+o.id));tinyMCEPreInit.mceInit["edit"+o.id]=a}if("undefined"==typeof tinyMCEPreInit.qtInit["edit"+o.id]){for(_prop in r)"string"==typeof r[_prop]&&"content_css"!==_prop&&(r[_prop]=r[_prop].replace(new RegExp("content","g"),"edit"+o.id));tinyMCEPreInit.qtInit["edit"+o.id]=r}tinyMCE.init({id:tinyMCEPreInit.mceInit["edit"+o.id]}),quicktags({id:"edit"+o.id}),QTags._buttonsInit(),jQuery("#wp-edit"+o.id+"-wrap").hasClass("tmce-active")?jQuery("#edit"+o.id+"-tmce").click():jQuery("#edit"+o.id+"-html").click(),"undefined"!=typeof t&&jQuery(window).trigger("icegram_tab_selected",[t])}}))}),jQuery("#campaign_target_rules").on("click","#add_local_url_row",function(e){e.preventDefault();var t=a();jQuery(".local_url").find(".url_input_field").length?jQuery(t).insertAfter(jQuery(".local_url").find(".url_input_field").last().parent("span")):jQuery(t).insertBefore(jQuery(".local_url").find("#add_local_url_row_label"))}),jQuery("#campaign_target_rules").on("click",".delete-url",function(e){jQuery(this).parent().remove()}),jQuery("select.ajax_chosen_select_messages").next("div").on("click","div.chosen-drop",function(){jQuery(this).closest("h3.hndle").trigger("click")}),jQuery("#campaign_data").on("click",".campaign_preview",function(e){jQuery(this).closest("h3.hndle").trigger("click"),0!=jQuery(".message-row").length&&(tinyMCE.triggerSave(),params=jQuery("#post").serializeArray(),params.push({name:"action",value:"save_campaign_preview"}),jQuery.ajax({type:"POST",async:!1,url:icegram_writepanel_params.ajax_url,data:params,success:function(e){""!=e&&window.open(e,"preview_window")}}))}),jQuery("select.icegram_chosen_page").chosen({disable_search_threshold:10}),jQuery("input#users_logged_in, input#users_all ,input#users_not_logged_in").on("change",function(){"logged_in"==jQuery(this).val()?(jQuery("select#users_roles").parent("p").show(),jQuery("#users_roles_chosen").find("input").trigger("click")):jQuery("select#users_roles").parent("p").hide()}),jQuery(".schedule_rule").on("change",function(){"when_schedule"==jQuery(this).attr("id")?jQuery("#date_picker").show():jQuery("#date_picker").hide()}),jQuery("input#where_other_page").on("change",function(){jQuery("select#where_page_id").parent("p").slideToggle(),jQuery(this).is(":checked")&&jQuery("#where_page_id_chosen").find("input").trigger("click")}),jQuery("input#where_sitewide").on("change",function(){jQuery("select#exclude_page_id").parent("p").slideToggle(),jQuery(this).is(":checked")&&jQuery("#exclude_page_id_chosen").find("input").trigger("click")}),jQuery("input#where_local_url").on("change",function(){jQuery(".local_url").slideToggle()}),jQuery(".date-picker").datepicker({dateFormat:"yy-mm-dd",defaultDate:0,showOtherMonths:!0,selectOtherMonths:!0,changeMonth:!0,changeYear:!0,showButtonPanel:!0}),jQuery("#campaign_target_rules").on("focusout","input.url_input_field",function(){var e=this;if(jQuery(e).parent().find("span#valid-field").removeClass("error"),"undefine"!==jQuery(e).data("option")&&"local_url"==jQuery(e).data("option")&&"*"!=jQuery(e).val()){var t=e.value;if(t.indexOf(r)<0)return void jQuery(e).val(r+t)}})});