jQuery(function(){function e(e){var t=jQuery(e).find(".message_type option:selected").val(),i=jQuery(e).find(".message_row.ig_"+t).find(".message_theme").val(),a=jQuery(e).find(".message_row.ig_"+t).find("#message_form_style").val(),r=jQuery(e).find("#message_theme_ig_"+t).find("."+i).attr("style"),s=jQuery(e).find("#message_form_style").find("."+a).attr("style");jQuery(e).find(".message_row, .location").hide(),jQuery(e).find(".ig_"+t).show(),jQuery(e).find(".message_row.ig_"+t).find(".message_theme").next().find(".chosen-single span").attr("style",r),jQuery(e).find(".message_row.ig_"+t).find(".message_form_style").next().find(".chosen-single span").attr("style",s).text(function(){return jQuery(this).text().substr(0,jQuery(this).text().indexOf(" "))||jQuery(this).text()}),"block"!==jQuery(e).find(".message_body").parent().css("display")?jQuery(e).find(".message_body").parent().next(".wp-editor-wrap").hide():jQuery(e).find(".message_body").parent().next(".wp-editor-wrap").show(),jQuery(e).find(".message_form_layout:checked").is(":visible")||jQuery(e).find(".message_form_layout:visible").first().prop("checked",!0),jQuery(".message_form_layout").change()}function t(e,i,a){var r=Math.floor(Math.random()*(a-i+1))+i;return r==e?t(r,i,a):r}function i(){var e='<span><label class="options_header"><span id="valid-field"> </span></label> <input  type="text" class="url_input_field" data-option="local_url"  name="campaign_target_rules[local_urls][]" value="'+r+'*"/><span class="delete-url"></span></span>';return e}function a(){0==jQuery(".message-row").length?jQuery(".empty_campaign").show():jQuery(".empty_campaign").hide()}var r=icegram_writepanel_params.home_url;jQuery("#campaign_data").find("h3.hndle").hide(),jQuery(".target_rules_desc").appendTo("#campaign_target_rules h3.hndle span"),jQuery(document).ready(function(){var i=window.send_to_editor;jQuery("#postdivrich").hide(),jQuery(".color-field").wpColorPicker().each(function(e){var t=jQuery(this).data("color-label")||"";""!==t&&jQuery(this).closest(".wp-picker-container").find("a.wp-color-result").attr("title",t)}),jQuery("#campaign_data").on("change",".show_color_options",function(){jQuery(this).closest("p").next(".message_colors_options_container").toggle(!this.checked)}).change(),a(),jQuery(".message_edit:first").trigger("click"),this_data=jQuery(".message_type option:selected").closest(".message-setting-fields");for(var r=0;r<this_data.length;r++)e(this_data[r]);jQuery(".inside").on("change",".message_type",function(t){var i=jQuery(t.target).parents(".message-setting-fields");e(i)}),jQuery("#campaign_data, #message-settings").on("change",".message_theme",function(e){var t=jQuery(e.target).parents(".message-setting-fields"),i=jQuery(t).find(".message_type").val(),a=jQuery(t).find(".message_row.ig_"+i).find(".message_theme").val(),r=jQuery(t).find("#message_theme_ig_"+i).find("."+a).attr("style");jQuery(t).find(".message_row.ig_"+i).find(".message_theme").next().find(".chosen-single span").attr("style",r)}),jQuery("#campaign_data").on("click",".message_image_button",function(e){var t=this;return window.send_to_editor=function(e){imgurl=jQuery("img",e).attr("src"),jQuery(t).parent().find("#upload_image").val(imgurl),tb_remove(),window.send_to_editor=i},!1}),jQuery("#campaign_data ,#message-settings").on("click",".message_headline_button",function(){var e=jQuery(this).prev().attr("data-headline"),i=icegram_writepanel_params.available_headlines.length,a=t(e,0,i),r=icegram_writepanel_params.available_headlines[a];jQuery(this).prev().val(r)}),jQuery(".tips, .help_tip").tipTip({attribute:"data-tip"}),jQuery("span.test_class").hover(function(){jQuery(this).next().show()},function(){jQuery(this).next().hide()}),jQuery("#campaign_data .hndle, #campaign_data .handlediv").unbind("click"),jQuery("#campaign_data .handlediv").hide()}),jQuery("#campaign_data").on("click",".message_delete",function(){jQuery(this).parent().parent().next().remove(),jQuery(this).parent().parent().remove(),a()}),jQuery("#campaign_data").on("click",".message_edit",function(){jQuery(this).parent().parent().next().toggle(),jQuery(this).parent().parent().find(".message-title-text, .message-title-input").toggle()}),jQuery("#campaign_data").on("change",".message-title-input",function(){jQuery(this).prev().text(jQuery(this).val())}),jQuery("select.ajax_chosen_select_messages").ajaxChosen({type:"GET",url:icegram_writepanel_params.ajax_url,dataType:"json",afterTypeDelay:100,data:{action:"icegram_json_search_messages",security:icegram_writepanel_params.search_message_nonce}},function(e){var t={};return jQuery.each(e,function(e,i){t[e]=i}),t}),jQuery("#campaign_data").on("change",".show_form_options",function(e){var t=jQuery(this).closest("p");if(jQuery(t).siblings(".message_form_options").slideToggle(this.checked),this.checked)jQuery(t).siblings(".message_form_options").find(".message_form_layout").change();else{jQuery(t).siblings("p.cta-actions").find("select option").removeAttr("disabled");var i=jQuery(t).siblings(".message_form_options").siblings(".wp-editor-wrap").find(".wp-editor-area"),a=jQuery(i).val().trim().replace("[ig_form]","");jQuery(i).val(a)}}).change(),jQuery("#campaign_data, #message-settings").on("change",".message_form_style",function(e){var t=jQuery(e.target).parents(".message-setting-fields"),i=jQuery(t).find("#message_form_style").val(),a=jQuery(t).find("#message_form_style").find("."+i).attr("style");jQuery(t).find(".message_form_style").next().find(".chosen-single span").attr("style",a).text(function(){return jQuery(this).text().substr(0,jQuery(this).text().indexOf(" "))||jQuery(this).text()})}),jQuery("#campaign_data").on("change",".message_form_layout ",function(){var e=jQuery(this).closest(".message_form_options").siblings(".wp-editor-wrap").find(".wp-editor-area"),t=jQuery(e).val().trim();if(jQuery(this).is(":visible")){var i=this;jQuery(i).closest(".form_radio_group").siblings(".form_inline_shortcode").hide(),jQuery(i).closest(".form_radio_group").siblings(".message_form_color").show().end().siblings(".form_inline_shortcode").hide(),jQuery(i).is(":checked")&&jQuery(i).closest(".message_form_options").prev("p.message_form_options_check").find(".show_form_options").is(":checked")&&("inline"==jQuery(i).val()?(-1==t.indexOf("[ig_form]")&&(t+="[ig_form]"),jQuery(i).closest(".form_radio_group").siblings(".message_form_color, .form_inline_shortcode").toggle()):"inline"!=jQuery(i).val()&&(t=t.replace("[ig_form]","")))}else t=t.replace("[ig_form]","");jQuery(e).val(t)}),jQuery("#campaign_data").on("blur",".message_form_html_original",function(e){var t=this,i=jQuery("<div/>").html(jQuery(t).val()).find("input[type=submit], button, input[type=button]");if(jQuery(a).parent().find("p.cta-actions select option").removeAttr("disabled"),i.length>0){var a=jQuery(t).closest(".message_form_options"),r=jQuery(i[i.length-1]),s=r.is("button")?r.not("br, span, div").text():r.val();jQuery(a).siblings("p").find("#message_label").val(s.trim()),jQuery(a).parent().find("p.cta-actions select").find('option[value="url"], option[value="hide"], option[value="cta_another_message"]').attr("disabled",!0).attr("selected",!1).end().find('option[value="form"]').attr("selected",!0).trigger("change")}}),jQuery(".ajax_chosen_select_messages").chosen(),jQuery("#campaign_data").on("change",".ajax_chosen_select_messages",function(){var t=jQuery("#ig-tabs li.current").attr("variation_id"),i=jQuery.extend({},tinyMCEPreInit.mceInit.content),r=jQuery.extend({},tinyMCEPreInit.qtInit.content),s=jQuery(this).parent().siblings(".campaign_target_rules_panel"),n=jQuery(s).find(".message-row").length,o=jQuery(this).val();return""==o?void jQuery(".ajax_chosen_select_messages").val("").trigger("chosen:updated"):(jQuery(".message-edit-row").hide(),jQuery(".message-title-text").show(),jQuery(".message-title-input").hide(),void jQuery.ajax({type:"POST",url:icegram_writepanel_params.ajax_url,dataType:"json",data:{action:"get_message_action_row",message_id:o,row:n},success:function(o){if(n++,jQuery(s).find(".messages-list .messages_list_table tbody").append(o.main),jQuery(".color-field").wpColorPicker().each(function(e){var t=jQuery(this).data("color-label")||"";""!==t&&jQuery(this).closest(".wp-picker-container").find("a.wp-color-result").attr("title",t)}),jQuery("#campaign_data").on("change",".show_color_options",function(){jQuery(this).closest("p").next(".message_colors_options_container").toggle(!this.checked)}).change(),e(jQuery("#"+o.id)),jQuery(".ajax_chosen_select_messages").val("").trigger("chosen:updated"),jQuery("select.icegram_chosen_page").chosen({disable_search_threshold:10}),a(),jQuery(".message-setting-fields").trigger("change"),jQuery(".tips, .help_tip").tipTip({attribute:"data-tip"}),"undefined"==typeof tinyMCEPreInit.mceInit["edit"+o.id]){for(_prop in i)"string"==typeof i[_prop]&&"content_css"!==_prop&&(i[_prop]=i[_prop].replace(new RegExp("content","g"),"edit"+o.id));tinyMCEPreInit.mceInit["edit"+o.id]=i}if("undefined"==typeof tinyMCEPreInit.qtInit["edit"+o.id]){for(_prop in r)"string"==typeof r[_prop]&&"content_css"!==_prop&&(r[_prop]=r[_prop].replace(new RegExp("content","g"),"edit"+o.id));tinyMCEPreInit.qtInit["edit"+o.id]=r}tinyMCE.init({id:tinyMCEPreInit.mceInit["edit"+o.id]}),quicktags({id:"edit"+o.id}),QTags._buttonsInit(),jQuery("#wp-edit"+o.id+"-wrap").hasClass("tmce-active")?jQuery("#edit"+o.id+"-tmce").click():jQuery("#edit"+o.id+"-html").click(),"undefined"!=typeof t&&jQuery(window).trigger("icegram_tab_selected",[t])}}))}),jQuery("#campaign_target_rules").on("click","#add_local_url_row",function(e){e.preventDefault();var t=i();jQuery(".local_url").find(".url_input_field").length?jQuery(t).insertAfter(jQuery(".local_url").find(".url_input_field").last().parent("span")):jQuery(t).insertBefore(jQuery(".local_url").find("#add_local_url_row_label"))}),jQuery("#campaign_target_rules").on("click",".delete-url",function(e){jQuery(this).parent().remove()}),jQuery("select.ajax_chosen_select_messages").next("div").on("click","div.chosen-drop",function(){jQuery(this).closest("h3.hndle").trigger("click")}),jQuery("#campaign_data").on("click",".campaign_preview",function(e){jQuery(this).closest("h3.hndle").trigger("click"),0!=jQuery(".message-row").length&&(tinyMCE.triggerSave(),params=jQuery("#post").serializeArray(),params.push({name:"action",value:"save_campaign_preview"}),jQuery.ajax({type:"POST",async:!1,url:icegram_writepanel_params.ajax_url,data:params,success:function(e){""!=e&&window.open(e,"preview_window")}}))}),jQuery("select.icegram_chosen_page").chosen({disable_search_threshold:10}),jQuery("input#users_logged_in, input#users_all ,input#users_not_logged_in").on("change",function(){"logged_in"==jQuery(this).val()?(jQuery("select#users_roles").parent("p").show(),jQuery("#users_roles_chosen").find("input").trigger("click")):jQuery("select#users_roles").parent("p").hide()}),jQuery(".schedule_rule").on("change",function(){"when_schedule"==jQuery(this).attr("id")?jQuery("#date_picker").show():jQuery("#date_picker").hide()}),jQuery("input#where_other_page").on("change",function(){jQuery("select#where_page_id").parent("p").slideToggle(),jQuery(this).is(":checked")&&jQuery("#where_page_id_chosen").find("input").trigger("click")}),jQuery("input#where_sitewide").on("change",function(){jQuery("select#exclude_page_id").parent("p").slideToggle(),jQuery(this).is(":checked")&&jQuery("#exclude_page_id_chosen").find("input").trigger("click")}),jQuery("input#where_local_url").on("change",function(){jQuery(".local_url").slideToggle()}),jQuery(".date-picker").datepicker({dateFormat:"yy-mm-dd",defaultDate:0,showOtherMonths:!0,selectOtherMonths:!0,changeMonth:!0,changeYear:!0,showButtonPanel:!0}),jQuery("#campaign_target_rules").on("focusout","input.url_input_field",function(){var e=this;if(jQuery(e).parent().find("span#valid-field").removeClass("error"),"undefine"!==jQuery(e).data("option")&&"local_url"==jQuery(e).data("option")&&"*"!=jQuery(e).val()){var t=e.value;if(t.indexOf(r)<0)return void jQuery(e).val(r+t)}})});